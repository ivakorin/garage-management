name: Build and Publish Docker Image
run-name: Build and Publish Docker Image


on:
  push:
    branches:
      - master

jobs:
  build-and-publish:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Docker Login
        env:
          DOCKER_PASSWORD: ${{ secrets.GITFLIC_TOKEN }}
        run: |
          echo "$DOCKER_PASSWORD" | docker login registry.gitflic.ru \
            -u "${{ secrets.GITFLIC_USER }}" \
            --password-stdin
      - name: Build Backend Docker Image
        run: docker build -t ${{ secrets.DOCKER_IMAGE }} -f services/docker/backend.Dockerfile . --progress=plain
      - name: Push Backend to Registry
        run: docker push ${{ secrets.DOCKER_IMAGE }}
      - name: Build Frontend Docker Image
        run: docker build -t ${{ secrets.DOCKER_IMAGE_FRONTEND }} -f services/docker/frontend.Dockerfile . --progress=plain
      - name: Push Frontend to Registry
        run: docker push ${{ secrets.DOCKER_IMAGE_FRONTEND }}
      - name: Docker Logout
        run: docker logout registry.gitflic.ru

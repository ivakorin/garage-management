## **Архитектура приложения**

Приложение представляет собой ****полнофункциональный IoT‑стек**** с клиент‑серверной
архитектурой,включающий сборданных с устройств, обработку, хранениеи визуализацию.

### **Общая структура**

Проект разбит на 3 ключевых блока:

- **backend** — серверная логика(Python);
- **frontend** — веб‑интерфейс(Vue.js);
- **services** — инфраструктура(Docker, Nginx, systemd).

### Backend(Python)

****Тип архитектуры:**** модульный монолит с чёткой сегментацией по responsibilities.

****Ключевые компоненты:****

1. `api/` — REST‑API на FastAPI:
    - версия api_v1;
    - точка входа—main.py.
2. `collectors/` — сборщики данных:
    - data_collector.py — общий коллектор;
    - mqtt_collector.py — приём данных по MQTT.
3. `db/` — слой доступа к данным:
    - ORM—SQLAlchemy(database.py,session.py);
    - модели баз данных.
4. `models/` — ORM‑модели(сенсоры, плагины, настройки).
5. `schemas/` — Pydantic‑схемыдлявалидацииAPI.
6. `services/` — бизнес‑логика:
    - automations.py—автоматизации;
    - mqtt_client.py—клиент MQTT;
    - redis_publisher.py—публикация в Redis;
    - ws_manager.py—управление WebSocket.
7. `plugins/` — модули для конкретных устройств:
    - примеры: air_quality_sensor_example.py, CSS811_sensor_example.py;
    - шаблон для новых плагинов — template.py.
8. `core/` — базовыеутилиты:
    - config.py — конфигурация;
    - logging.py — логирование;
    - settings.py — настройки.
9. `utils/` — вспомогательные функции(парсеры, хелперы).

****Технологии:****

- FastAPI(веб‑фреймворк);
- SQLAlchemy2.0(ORM);
- aiomqtt(асинхронный MQTT‑клиент);
- Redis(кеширование/очереди);
- PyYAML(работа с конфигурациями).

### **Frontend(Vue.js3)**

****Структура:****

- `src/api` — API‑клиенты;
- `src/components` — UI‑компоненты;
- `src/pages` — страницы приложения;
- `src/router` — маршрутизация;
- `src/ws`— обработка WebSocket;
- `src/i18n.ts` — локализация.

****Ключевыебиблиотеки:****

- Vue3;
- VueRouter4;
- VueI18n9;
- NaiveUI(компонентный фреймворк);
- ECharts(визуализация данных);
- Axios(HTTP‑запросы).

****Сборка:**** Vite(конфигурациявvite.config.ts).

### **Инфраструктура(**services/**)**

1. ****Docker:****
    - `backend.Dockerfile`— образ бэкенда;
    - `frontend.Dockerfile`— образ фронтенда;
    - `docker-compose.yaml`— оркестрация сервисов.
2. ****Nginx**** — обратный прокси для фронтенда/бэкенда.
3. ****Systemd**** — управление сервисами:
    - `api.service` — запуск API;
    - `collector.service`— запуск коллектора;
    - `redis.service`— управление Redis.

### **Интеграци и ипротоколы**

1. ****MQTT**** — приём данных с устройств(через aiomqtt).
2. ****HTTP/HTTPS**** — API для фронтенда и внешних систем.
3. ****WebSocket**** — реальные обновления для интерфейса.
4. ****Redis**** — кеширование и брокер сообщений.

### **Хранение данных**

1. ****SQL‑база**** SQLite(через SQLAlchemy)—структурированные данные(
   настройки,метаданные).
2. ****Redis**** — временные данные,кеши,очереди.
3. ****Файлы**** — конфигурации(YAML).

### **Дополнительные компоненты**

- ****Тесты**** (tests/) — юнит‑тесты(pytest).
- ****Документация**** (docs/) — описание API,архитектуры,развёртывания.
- ****Скрипты**** (install.sh) — автоматизацияустановки.
- ****Конфигурация**** — через pyproject.toml и poetry.lock(управление зависимостями).

### **Потоки данных**

1. Устройства → MQTT → mqtt_collector.py → обработка → SQL/Redis.
2. Фронтенд → API(FastAPI) → бизнес‑логика → базыданных.
3. Обновления → WebSocket → фронтенд.

### **Особенности**

- ****Асинхронность**** — использование asyncio(FastAPI,aiomqtt).
- ****Модульность**** — плагины для поддержки разных устройств.
- ****Масштабируемость**** — Docker/Compose для развёртывания.
- ****Реальностьвремени**** — WebSocket и MQTT для мгновенных обновлений.